<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="org.conan.mapper.MemberMapper">

<!-- 추가 -->
<resultMap type="org.conan.domain.MemberVO" id="memberMap">

      <id property="userid" column="userid" />

      <result property="userid" column="userid" />

      <result property="userpwd" column="userpwd" />

      <result property="username" column="username" />

      <result property="regDate" column="regdate" />

      <result property="updateDate" column="updatedate" />

      <collection property="authList" resultMap="authMap">
      </collection>

   </resultMap>

   <resultMap type="org.conan.domain.AuthVO" id="authMap">

      <result property="userid" column="userid" />

      <result property="auth" column="auth" />

   </resultMap>

   <select id="read" resultMap="memberMap">

      select

      mem.userid,userpwd,username,enabled,regdate,updatedate,auth from

      tbl_member mem left outer join tbl_member_auth auth on mem.userid =

      auth.userid where mem.userid=#{userid}

   </select>
   
<insert id="insertMember"> <!-- 멤버 생성 -->
 insert into tbl_member values(#{userid},#{userpwd},#{username},sysdate,sysdate,1)
</insert>
 <insert id="a_insertMember"> <!-- 멤버 권한 부여 -->
 insert into tbl_member_auth (userid, auth) values(#{userid}, 'ROLE_USER')
</insert>


<insert id="register">
insert into tbl_member values(#{userid},#{userpwd})
</insert>
<select id="login" resultType="org.conan.domain.MemberVO">
select  userid,userpwd from tbl_member where  userid = #{userid} and userpwd= #{userpwd}
</select>
<select id="Idcheck" resultType="int">
select count(*) from tbl_member where userid = #{userid}
</select>
<update id="update">
update tbl_member set userpwd = #{userpwd} where userid=#{userid}
</update>


</mapper>